<nav class="navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#"></a>
  <%# <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search"> %>
  <ul class="navbar-nav px-3">
    <li class="nav-item text-nowrap">
      <%# <a class="nav-link" href="#">Sign out</a> %>
    </li>
  </ul>
</nav>
<div class="container-fluid">
  <div class="row">
    <nav class="col-md-2 d-none d-md-block bg-light sidebar">
      <div class="sidebar-sticky">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" href="#">
              <span data-feather="home"></span>
              Dashboard <span class="sr-only">(current)</span>
            </a>
          </li>
          <li class="nav-item">
            <%# <a class="nav-link active" href="">
                Manage Buckets <span class="sr-only">(current)</span>
              </a> %>
          </li>
          <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
            <span>Buckets</span>
          </h6>
          <ul class="nav flex-column mb-2">
            <li class="nav-item">
              <%= link_to buckets_path, class: "nav-link" do %>
                <span data-feather="clipboard"></span>Manage
              <% end %>
            </li>
          </ul>
        </div>
      </nav>
      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
        <div class="container-fluid pb-3">
          <div class="row">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center col-6">
              <h1 class="h2"></h1>
              <div class="input-group input-group-sm flex-nowrap">
                <%= form_with(url: "/buckets", method: "post", class: "form-inline", local: true) do %>
                  <%= text_field_tag(:name, nil, class: "form-control", placeholder: "Bucket Name") %>
                  <div class="input-group-append">
                    <%= button_tag("Create", class: "btn btn-outline-secondary") %>
                  </div>
                <% end %>
              </div>
            </div>
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center col-6">
              <h1 class="h2"></h1>
              <div class="btn-toolbar mb-2 mb-md-0">
                <div class="btn-group mr-2">
                  <div class="custom-file" id="customFile">
                    <%= form_with url: upload_cc_path, method: "post", local: true, :html=> {:multipart=>true} do %>
                      <%= file_field :attachment, :file,
                        accept: "text/csv, text/plain",
                        class: "custom-file-input" ,
                        onchange: 'this.form.submit();'
                      %>
                      <label class="custom-file-label" for="customFile">Upload CC CSV</label>
                    <% end %>
                  </div>
                  &nbsp;
                  <button type="button" class="btn btn-sm btn-outline-secondary">Upload Account CSV</button>
                  <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row pt-3 border-bottom"></div>
        </div>
        <% if @notice != nil %>
          <div class="alert alert-info" role="alert">
            <%= @notice %>
          </div>
        <% end %>
        <div class="table-responsive">
          <span class="badge badge-success float-right p-1">Total: $<%= LineItem.total_nil_buckets %></span>
          <h4>Unknown Buckets</h4>
          <table class="table table-striped table-sm table-hover shadow-sm">
            <thead class="thead-light">
              <tr>
                <th>Post Date</th>
                <th>Description</th>
                <th>Amount</th>
                <th>Bucket</th>
              </tr>
            </thead>
            <tbody>
              <% @unbucketed.each do |item|%>
                <tr>
                  <td><%= item[:post_date].strftime("%m/%d/%Y") %></td>
                  <td><%= item[:description] %></td>
                  <td><%= item[:amount] %></td>
                  <td>
                    <%= form_with model: item, url: assign_line_item_path(item), scope: :bucket, method: :put, local: true do |f| %>
                      <%= f.collection_select(
                        :id, Bucket.all, :id, :name,
                        { include_blank: "None", :selected => "None"},
                        { onchange: 'this.form.submit();' }
                      ) %>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
          <% @buckets.each do |bucket|%>
            <span class="badge badge-success float-right p-1">Total: $<%= bucket.total_line_items %></span>
            <h4><%= bucket[:name] %></h4>
            <table class="table table-striped table-sm table-hover table-fixed shadow-sm">
              <thead class="thead-light">
                <tr>
                  <th>Post Date</th>
                  <th>Description</th>
                  <th>Amount</th>
                  <th>Bucket</th>
                </tr>
              </thead>
              <tbody>
                <% bucket.line_items.each do |item|%>
                  <tr>
                    <td><%= item[:post_date].strftime("%d/%m/%Y") %></td>
                    <td><%= item[:description] %></td>
                    <td><%= item[:amount] %></td>
                    <td>
                      <%= form_with model: item, url: assign_line_item_path(item), scope: :bucket, method: :put, local: true do |f| %>
                        <%= f.collection_select(
                          :id, Bucket.all, :id, :name,
                          { include_blank: "None", :selected => bucket.id},
                          { onchange: 'this.form.submit();' }
                        ) %>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          <% end %>
        </div>
      </main>
    </div>
  </div>
</body>
